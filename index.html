<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>AngularJS Directive Crash Course</title>

    <meta name="author" content="Moritz Grauel">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

</head>

<body>

<div class="reveal">

    <div class="slides">
        <section id='title'
                 data-background='img/AngularJS-Shield-large.png' data-background-size='400px'>
            <h1>Angular JS</h1>

            <h3>Directive Crash Course</h3>

            <p class="text-shadow">
                <a href="http://moritz.grauel.is/awesome">Moritz Grauel</a> / <a href="http://twitter.com/mo_gr">@mo_gr</a>
            </p>
        </section>

        <section>
            <img src="img/Driving_School_Car_Crash.jpg" alt="Driving School Car Crash" width="640"/>
        </section>
        <section>
            <img src="img/owl.jpg" alt="How to draw an owl"/>
        </section>

        <section>
            <h1>Moritz Grauel</h1>
            <p class="tagline">Berlin native. Bit herder. Code connoisseur. Coffee lover.</p>
            <p>Freelance Software Entwickler &amp; Trainer</p>
            <p>Web – JVM – iOS</p>
        </section>

        <section>
            <section>
                <img src="img/AngularJS-large.png" alt="AngularJS Logo" class="whiteBox">
            </section>
            <section>
                <h3>Superheroic JavaScript MVW Framework</h3>
                <ul>
                    <li>Client Side MVC Framework</li>
                    <li>ehemals 20% Projekt bei Google</li>
                    <li>&gt; 5 Jahre</li>
                    <li>aktuell 1.2.15</li>
                    <li>aktive Community, &gt; 400 Contributor</li>
                    <li>Github, MIT</li>
                </ul>
            </section>
            <section>
                <h3>AngularJS Killer Features</h3>
                <ul>
                    <li>Modulare Anwendungsstruktur &amp; Testbarkeit</li>
                    <li>Dependency Injection</li>
                    <li>2-way Data Binding</li>
                    <li>Template System</li>
                </ul>
            </section>
            <!--<section><img src="img/curves.jpg" alt="learning curves"></section>-->
            <!--<section><img src="img/feelings_about_angularjs_over_time.png" alt="angularjs learning curve"></section>-->
            <section>
                <h3>Demo: <code>hello-angular</code></h3>
            </section>
        </section>

        <section>
            <section>
                <h3>AngularJS Direktiven</h3>
                <p class="fragment fade-in"><code>ng-app, ng-controller, ng-click, ...</code></p>
                <p class="fragment fade-in">Nicht nur Attribute, auch Elemente</p>
            </section>
            <section>
                <h3>Direktiven sind Marker im DOM</h3>
                <h3>für JavaScript execution</h3>
            </section>
            <section>
                <h3>jQuery vs Direktiven</h3>
                <pre class="fragment fade-in"><code class="javascript">$("#content form.form ul ~ input + div").on("click", fmlHandler);</code></pre>
                <p class="fragment fade-in">vs.</p>
                <pre class="fragment fade-in"><code><div ng-click="fml()">You can't touch this!</div></code></pre>
                <pre class="fragment fade-in"><code><div fml="">You can't touch this!</div></code></pre>
                <pre class="fragment fade-in"><code><fml>You can't touch this!</fml></code></pre>
            </section>
            <section>
                <h3>Eigene Direktiven</h3>
            </section>
            <section>
                <h3>Demo: <code>hello-directive</code></h3>
            </section>
        </section>
        <section>
            <!--<section>-->
                <!--<h3>jQuery vs AngularJS</h3>-->
                <!--<ul>-->
                    <!--<li>Angular uses jQuery when available</li>-->
                    <!--<li>transparently falls back to jqLite</li>-->
                    <!--<li>new to Angular? – Don't include jQuery</li>-->
                <!--</ul>-->
            <!--</section>-->
            <!--<section>-->
                <!--<img src="img/jakeweary.png" alt="jQuery"/>-->
            <!--</section>-->

            <section>
                <h3>Was gehört in eine Direktive?</h3>
                <ul>
                    <li class="fragment fade-in">DOM Interaktion</li>
                    <li class="fragment fade-in">3rd Party JS Bibliotheken</li>
                    <li class="fragment fade-in">UI Widgets</li>
                    <li class="fragment fade-in">semantisches Templating</li>
                </ul>
            </section>
            <section>
                <h3>semantisches Templating</h3>
                <pre><code>
<app>
    <header>
        <navigation-bar></navigation-bar>
        <user-info></user-info>
    </header>
    <content>
        <sidepanel></sidepanel>
        <awesome-magic-product></awesome-magic-product>
    </content>
    <footer></footer>
</app>

                </code></pre>
            </section>
            <section>
                <h3>Was gehört in eine Direktive?</h3>
                <ul>
                    <li >DOM Interaktion</li>
                    <li >3rd Party JS Bibliotheken</li>
                    <li >UI Widgets</li>
                    <li >semantisches Templating</li>
                </ul>
            </section>
            <section>
                <h3><a href="http://angular-ui.github.io">Angular-UI</a></h3>
                <ul>
                    <li>Twitter Bootstrap (und weitere)</li>
                    <li>als direktiven verpackt</li>
                    <li>gutes Beispiel zum lernen</li>
                </ul>
            </section>
            <section>
                <h3>Keep 'em stupid</h3>
                <ul>
                    <li>wenig/keine Logik in direktiven</li>
                    <li>kein AJAX etc</li>
                    <li>DOM ist Komplexität genug</li>
                    <li>Business Logik gehört in services</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <h3>Direktiven Deklarieren</h3>
                <ul>
                    <li>immer in Modul Kontext</li>
                    <li><code>directive()</code> Funktion</li>
                </ul>
                <pre><code class="javascript">
                    var module = angular.module('Example', []);
                    module.directive('directiveName', function() {
                        return {
                          // describe directive
                        };
                    });
                </code></pre>
            </section>
            <section>
                <h3>Normalisierter Name</h3>
                <ol>
                    <li>Strip <code>x-</code> und <code>data-</code></li>
                    <li>Konvertiere <code>:</code> zu camelCase</li>
                    <li>Konvertiere <code>-</code> zu camelCase</li>
                    <li>Konvertiere <code>_</code> zu camelCase</li>
                </ol>
                <pre><code class="javascript">app.directive('fooBar', ...)</code></pre>
            <pre><code>
                &lt;foo-bar/>
                &lt;foo:bar/>
                &lt;foo_bar/>
                <div x-foo-bar=""></div>
                <div data-foo-bar=""></div>
                <div foo-bar=""></div>
            </code></pre>
            </section>
            <section>
                <h3>Arten von Direktiven</h3>
                <ol>
                    <li>Tag <pre><code>&lt;my-user/&gt;</code></pre></li>
                    <li>Attribut <pre><code>&lt;div my-user='user'&gt;</code></pre></li>
                    <li>CSS Klasse <pre><code>&lt;div class='my-user: user;'&gt;</code></pre></li>
                    <li>Kommentar <pre><code>&lt;!-- directive: my-user user --&gt;</code></pre></li>
                </ol>
            </section>
            <section>
                <h3>Direktiven Beschreiben</h3>
                <pre><code class="javascript">
            var module = angular.module('Example', []);
            module.directive('directiveName', function() {
              return {
                // describe directive
                link: linkFunction,
                restrict: 'EA'
                //...etc
              };
            });
                </code></pre>
            </section>
            <section>
                <h3><code>link</code></h3>
                <p>Link-Funktion</p>
                <p>nimmt <em>nicht</em> am DI teil</p>
                <pre><code class="javascript">
            link: function (scope, element, attribute) {
                // element is jqLite/jQuery wrapped
                // code to run on/with that element
            }
                </code></pre>
            </section>
            <section>
                <h3><code>restrict</code></h3>
                <p>Wo kann die directive verwendet werden</p>
                <p>String aus den Zeichen:</p>
                <ul>
                    <li><code>'E'</code> Element</li>
                    <li><code>'A'</code> Attribut (default)</li>
                    <li><code>'C'</code> Klasse</li>
                    <li><code>'M'</code> Kommentar</li>
                </ul>
                <pre><code class="javascript">
            {
              // snip
              restrict: 'EA',
              // ...snip
            }
                </code></pre>
            </section>

            <section>
                <h3><code>template</code> / <code>templateUrl</code></h3>
                <p>neue DOM Elemente in die Direktiven einfügen</p>
                <p>entweder inline oder über Angulars <em>templateCache</em></p>
                <pre><code class="javascript">
            app.directive('placeholder', function () {
              return {
                restrict: 'E',
                template: '<div>real deal!</div>'
              };
            });
                </code></pre>
            </section>
            <section>
                <h3><code>replace</code></h3>
                <p>neues template in DOM Element einfügen oder ersetzen</p>
                <p>default ist <em>false</em></p>
                <pre><code class="javascript">
            app.directive('placeholder', function () {
              return {
                restrict: 'E',
                replace: true,
                template: '<div>real deal!</div>'
              };
            });
                </code></pre>
            </section>
        </section>
        <section>
            <section>
                <h3>Noise Direktive</h3>
                <ul>
                    <li>halbwegs sinnvolles Beispiel</li>
                    <li>3rd Party Bibliothek <a href="http://howlerjs.com">Howler.js</a> einbinden</li>
                    <li>Direktive, die auf click einen Sound abspielt</li>
                </ul>
            </section>
            <section>
                <h3><a href="http://howlerjs.com">Howler.js</a> Minimal Beispiel</h3>
                <pre><code class="javascript">
                    var sound = new Howl({
                      urls: ['path/to/sound.mp3']
                    });
                    sound.play();
                </code></pre>
            </section>
            <section>
                <h3>TDD</h3>
            </section>
            <section>
                <h3>Direktiven &amp; Tests</h3>
                <p>Wir brauchen:</p>
                <ol>
                    <li class="fragment fade-in">Test Boilerplate – <a href="http://pivotal.github.io/jasmine/">Jasmine</a></li>
                    <li class="fragment fade-in">Test Runner – <a
                            href="http://karma-runner.github.io/0.12/index.html">Karma</a></li>
                    <li class="fragment fade-in">Angular Boilerplate – <a
                            href="http://code.angularjs.org/1.2.15/angular-mocks.js">Angular Mocks</a></li>
                </ol>
            </section>
            <section>
                <h3>Demo: <code>sound</code></h3>
            </section>
            <section>
                <h3>Noise Direktive</h3>
                <pre><code class="javascript">
            app.directive('noise', function($window) {
              return {
                link: function (scope, element, attrs) {
                  var sound = new $window.Howl({
                    urls: [attrs.noise]
                  });
                  element.on('click', function() {sound.play();});
                }
              };
            })
                </code></pre>
            </section>
            <section>
                <h3>Direktiventest Boilerplate</h3>
                <pre><code class="javascript">
describe('MyDirective Test', function () {
    var scope, element;
    // Load module
    beforeEach(module('MyModule'));
    // prepare directive
    beforeEach(inject(function($compile, $rootScope) {
        scope = $rootScope.$new();
        element = angular.element('<div my-directive="test">Test</div>');
        $compile(element)(scope);
    }));
    // actual tests
    it('should do something', function() {
        expect(something).toHaveHappened();
    });
});
                </code></pre>
            </section>
            <section>
                <h3>3rd Party Integration – Rückrichtung</h3>
                <ul>
                    <li>Callbacks und Eventlistener</li>
                    <li>Angulars Digest Cycle muss getriggert werden</li>
                    <li><code>scope.$apply()</code> ist der Schlüssel</li>
                </ul>
            </section>
            <section>
                <h3>Noise Direktive II.</h3>
                <pre><code class="javascript">
    app.directive('noise', function($window) {
        return {
            link: function (scope, element, attrs) {
                var sound = new $window.Howl({
                    urls: [attrs.noise],
                    onplay: function () {
                        scope.$apply(function () {
                            scope.playing = attrs.noise;
                        });
                    }
                });
                element.on('click', function() {sound.play();});
            }
        };
    })
                </code></pre>
            </section>
            <section>
                <h3>Typische Gefahr</h3>
                <ul>
                    <li>allmächtige Link-Funktion</li>
                    <li>schwer zu Testen</li>
                    <li><em>code smell</em></li>
                </ul>
            </section>
            <section>
                <h3><code>controller</code></h3>
                <ul>
                    <li>Direktiven Controlloer</li>
                    <li>inline oder via Name</li>
                    <li>ermöglicht Services, bessere Testbarkeit etc</li>
                </ul>
                <pre><code class="javascript">
    app.directive('complexDirective', function () {
        return {
            controller: 'complexDirectiveController',
            link: function(scope, elem, attr, controller) {
                controller.init(elem);
            };
        };
    });
    app.controller('complexDirectiveController',
                   function($scope, ComplexService) {
        // magic happens here
    });
                </code></pre>
            </section>
            <section>
                <h3>Direktiven Kommunikation via Controller</h3>
                <ul>
                    <li>Direktiven können Controller von anderen Direktiven verlangen</li>
                    <li>Klassisches Beispiel: cross field validation</li>
                </ul>
            </section>
            <section>
                <h3>Demo: <code>cross-field</code></h3>
            </section>
            <section>
                <h3><code>require</code></h3>
                <ul>
                    <li>Name oder Array von Namen anderer Direktiven</li>
                    <li>wird als 4. Parameter an die Link Funktion gegeben</li>
                    <li>Prefix '?' wirft keinen Fehler, wenn andere Direktive nicht vorhanden</li>
                    <li>Prefix '^' sucht im DOM weiter oben</li>
                </ul>
                <pre><code class="javascript">
app.directive('fooBar', function() {
    return {
        controller: 'fooBarController',
        require: ['reqDir', '?^optDir', 'fooBar'],
        link: function(s, e, a, controllers) {
            var reqDir = controllers[0];
            var ownController = controllers[2];
            if (controllers[1]) controllers[1].interact(reqDir);

        };
    }
});
                </code></pre>
            </section>
            <section>
                <h3><code>transclude</code></h3>
                <ul>
                    <li>ermöglicht das Einbinden von Direktiven Inhalt in Templates</li>
                    <li>klassisches Beispiel: MessageBox</li>
                    <li>assoziiert scope</li>
                </ul>
                <pre><code class="javascript">
app.directive('messageBox', function() {
    return {
        transclude: true,
        template: '<div class="fancyMessageBox">' +
            '<h1>Alert!</h1>' +
            '<div class="content" ng-transclude></div>' +
            '</div>'
    };
});
                </code></pre>
                <pre><code><messabe-box>Something went wrong: {{message}}</messabe-box></code></pre>
            </section>
        </section>
        <section>
            <section>
                <h3>scope?</h3>
                <ul>
                    <li class="fragment fade-in">Kleber zwischen View &amp; Controller</li>
                    <li class="fragment fade-in">hierarchich (prototypisch vererbt)</li>
                    <li class="fragment fade-in">beliebter Stolperstein</li>
                </ul>
            </section>
            <section>
                <h3><code>scope</code></h3>
                <ol>
                    <li><code>false</code> – Direktive hat keinen eigenen Scope (<em>default</em>)</li>
                    <li><code>true</code> – Direktive hat eigenen Child Scope</li>
                    <li><code>{}</code> – Direktive hat eigenen, isolierten Scope</li>
                </ol>
            </section>
            <section>
                <h3>Demo: <code>drinks</code></h3>
            </section>
            <section>
                <h3>isolate Scope</h3>
                <p>ermöglicht definiertes Interface einer Direktive</p>
                <ol>
                    <li><code>'@'</code> – unidirektionales Mapping in den Direktiven Scope</li>
                    <li><code>'='</code> – bidirektionales Mapping zwischen umliegendendem Scope und Direktive</li>
                    <li><code>'&'</code> – ermöglicht <em>function calls</em> im umliegendem Scope</li>
                </ol>
                <img src="img/isolateScope.png" alt="Isolate Scopes"/>
            </section>
        </section>
    <section>
        <section><h3>War's das?</h3></section>
        <section>
            <h3>weitere erlaubte Properties</h3>
            <ul>
                <li class="fragment fade-in"><code>priority</code></li>
                <li class="fragment fade-in"><code>terminal</code></li>
                <li class="fragment fade-in"><code>compile</code></li>
            </ul>
        </section>
        <section>
            <h3>Direktiven Deklarieren - Komplett</h3>
        <pre><code class="javascript">
    app.directive('example', function(MagicService) {
        // lazy one-time init
        return {
            restrict: 'EA',
            link: function(scope, elem, attrs, controllers) {
                // called per usage
            },
            // or compile: compileFn,
            templateUrl: 'neatTemplate.html',
            ,// or template: '...'
            replace: true,
            transclude: true,
            scope: {foo:'='},
            controller: 'aController',
            require: ['?^other', 'example']
            priority: 100,
            terminal: false
        };
    });
        </code></pre>
        </section>
    </section>
        <section>
            <section>
                <h3>Take Home Message</h3>
                <ul>
                    <li>Direktiven sind ein guter Weg zu wart- und testbaren Anwendungen.</li>
                    <li>Direktiven ermöglichen deklaratives Markup.</li>
                    <li>Der Einstieg in eigene Direktiven ist simpel.</li>
                    <li>Die mögliche Flexibilität impliziert gewisse Komplexität.</li>
                </ul>
            </section>
            <section>
                <h3>Vielen Dank!</h3>
            </section>
            <section>
                <h3>Fragen?</h3>
                <p><a href="http://blog.notadomain.com/bedcon-angular-directives/" target="_blank">Slides</a> auf <a target="_blank" href="https://github.com/mo-gr/bedcon-angular-directives">GitHub</a></p>
                <p>Get in touch!</p>
                <p><a href="https://twitter.com/mo_gr" target="_blank">@mo_gr</a></p>
                <p><a href="mailto:mo@notadomain.com">mo@notadomain.com</a></p>
                <p><a href="http://moritz.grauel.is/awesome" target="_blank">http://moritz.grauel.is/awesome</a></p>
            </section>
        </section>
    </div>
    <footer>
        Moritz – <a href="https://twitter.com/mo_gr" target="_blank">@mo_gr</a> - #bedcon
    </footer>
</div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

        Reveal.initialize({
            controls: false,
            progress: true,
            history: true,
            center: true,

            theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
            transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

            dependencies: [
                {
                    src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                      hljs.initHighlightingOnLoad();
                    }
                }
            ]
        });

    </script>

</body>
</html>
